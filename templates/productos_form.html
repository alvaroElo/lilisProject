{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}{{ action|title }} Producto - Dulcería Lilis{% endblock %}
{% block page_title %}{{ action|title }} Producto{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="#">Productos</a></li>
        <li class="breadcrumb-item active">{{ action|title }} Producto</li>
    </ol>
</nav>

<!-- Formulario -->
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="row g-4">
        <!-- Columna Principal (Información del Producto) -->
        <div class="col-12 col-lg-8">
            <!-- Información Básica -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-primary text-white">
                    <i class="fas fa-info-circle me-2"></i>Información Básica
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12 col-md-6">
                            <label for="codigo" class="form-label">Código del Producto <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="codigo" name="codigo" required>
                            <small class="text-muted">Código único del producto</small>
                        </div>
                        
                        <div class="col-12 col-md-6">
                            <label for="codigo_barras" class="form-label">Código de Barras</label>
                            <input type="text" class="form-control" id="codigo_barras" name="codigo_barras">
                        </div>
                        
                        <div class="col-12">
                            <label for="nombre" class="form-label">Nombre del Producto <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="nombre" name="nombre" required>
                        </div>
                        
                        <div class="col-12">
                            <label for="descripcion" class="form-label">Descripción</label>
                            <textarea class="form-control" id="descripcion" name="descripcion" rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Clasificación -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <i class="fas fa-tags me-2"></i>Clasificación
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12 col-md-6">
                            <label for="categoria" class="form-label">Categoría <span class="text-danger">*</span></label>
                            <select class="form-select" id="categoria" name="categoria" required>
                                <option value="">Seleccionar categoría</option>
                                <option>Chocolates</option>
                                <option>Dulces</option>
                                <option>Chicles</option>
                                <option>Paletas</option>
                            </select>
                        </div>
                        
                        <div class="col-12 col-md-6">
                            <label for="marca" class="form-label">Marca <span class="text-danger">*</span></label>
                            <select class="form-select" id="marca" name="marca" required>
                                <option value="">Seleccionar marca</option>
                                <option>Nestlé</option>
                                <option>Hershey's</option>
                                <option>Ricolino</option>
                                <option>Trident</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Precios y Stock -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <i class="fas fa-dollar-sign me-2"></i>Precios y Stock
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12 col-md-4">
                            <label for="precio_compra" class="form-label">Precio de Compra <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="precio_compra" name="precio_compra" step="0.01" required>
                            </div>
                        </div>
                        
                        <div class="col-12 col-md-4">
                            <label for="precio_venta" class="form-label">Precio de Venta <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="precio_venta" name="precio_venta" step="0.01" required>
                            </div>
                        </div>
                        
                        <div class="col-12 col-md-4">
                            <label for="margen" class="form-label">Margen de Ganancia</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="margen" name="margen" readonly>
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                        
                        <div class="col-12 col-md-6">
                            <label for="stock_minimo" class="form-label">Stock Mínimo <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="stock_minimo" name="stock_minimo" required>
                            <small class="text-muted">Genera alerta cuando el stock está por debajo</small>
                        </div>
                        
                        <div class="col-12 col-md-6">
                            <label for="stock_maximo" class="form-label">Stock Máximo</label>
                            <input type="number" class="form-control" id="stock_maximo" name="stock_maximo">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Información Adicional -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <i class="fas fa-clipboard-list me-2"></i>Información Adicional
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12 col-md-4">
                            <label for="unidad_medida" class="form-label">Unidad de Medida</label>
                            <select class="form-select" id="unidad_medida" name="unidad_medida">
                                <option>Unidad</option>
                                <option>Caja</option>
                                <option>Paquete</option>
                                <option>Kg</option>
                                <option>Litro</option>
                            </select>
                        </div>
                        
                        <div class="col-12 col-md-4">
                            <label for="peso" class="form-label">Peso/Contenido</label>
                            <input type="text" class="form-control" id="peso" name="peso" placeholder="ej: 50g, 1L">
                        </div>
                        
                        <div class="col-12 col-md-4">
                            <label for="ubicacion" class="form-label">Ubicación</label>
                            <input type="text" class="form-control" id="ubicacion" name="ubicacion" placeholder="ej: Estante A-1">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Columna Lateral (Opciones y Acciones) -->
        <div class="col-12 col-lg-4">
            <!-- Estado y Visibilidad -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <i class="fas fa-toggle-on me-2"></i>Estado
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="estado" class="form-label">Estado del Producto</label>
                        <select class="form-select" id="estado" name="estado">
                            <option value="activo">Activo</option>
                            <option value="inactivo">Inactivo</option>
                            <option value="descontinuado">Descontinuado</option>
                        </select>
                    </div>
                    
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="destacado" name="destacado">
                        <label class="form-check-label" for="destacado">
                            Producto Destacado
                        </label>
                    </div>
                    
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="requiere_refrigeracion" name="requiere_refrigeracion">
                        <label class="form-check-label" for="requiere_refrigeracion">
                            Requiere Refrigeración
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Imagen del Producto -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <i class="fas fa-image me-2"></i>Imagen
                </div>
                <div class="card-body text-center">
                    <div class="mb-3">
                        <img src="{% static 'img/placeholder-product.png' %}" 
                             alt="Preview" 
                             class="img-fluid rounded border" 
                             id="image-preview"
                             style="max-height: 200px;">
                    </div>
                    <input type="file" class="form-control" id="imagen" name="imagen" accept="image/*">
                    <small class="text-muted d-block mt-2">Formatos: JPG, PNG. Max: 2MB</small>
                </div>
            </div>
            
            <!-- Proveedor Predeterminado -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <i class="fas fa-truck me-2"></i>Proveedor
                </div>
                <div class="card-body">
                    <label for="proveedor" class="form-label">Proveedor Predeterminado</label>
                    <select class="form-select" id="proveedor" name="proveedor">
                        <option value="">Sin proveedor asignado</option>
                        <option>Distribuidora Central</option>
                        <option>Mayorista del Sur</option>
                        <option>Importadora Global</option>
                    </select>
                </div>
            </div>
            
            <!-- Acciones -->
            <div class="card border-0 shadow-sm sticky-top" style="top: 90px;">
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save me-2"></i>Guardar Producto
                        </button>
                        <a href="#" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </a>
                    </div>
                    
                    <hr class="my-3">
                    
                    <div class="text-muted small">
                        <i class="fas fa-info-circle me-2"></i>
                        Los campos marcados con <span class="text-danger">*</span> son obligatorios
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block module_js %}
<script>
// Preview de imagen
document.getElementById('imagen').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('image-preview').src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
});

// Calcular margen de ganancia
document.getElementById('precio_compra').addEventListener('input', calcularMargen);
document.getElementById('precio_venta').addEventListener('input', calcularMargen);

function calcularMargen() {
    const compra = parseFloat(document.getElementById('precio_compra').value) || 0;
    const venta = parseFloat(document.getElementById('precio_venta').value) || 0;
    
    if (compra > 0) {
        const margen = ((venta - compra) / compra * 100).toFixed(2);
        document.getElementById('margen').value = margen;
    }
}
</script>
{% endblock %}
